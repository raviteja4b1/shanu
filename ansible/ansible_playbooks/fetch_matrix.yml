---
- hosts: all
  gather_facts: false
  tasks:
    - add_host: 
        host: "{{target_machine}}"
      when: target_machine is defined 
- hosts: "{{target_machine | default('all') }}"
  gather_facts: false
  vars_files:
    - phase1/phase1_vault.yml
  vars:
    ansible_connection: winrm
    ansible_winrm_server_cert_validation: ignore
    ansible_ssh_port: 5986
    ansible_winrm_transport: ntlm
  tasks:
    - name: fetch matrix.csv
      fetch: 
        src: \\stp-it227\IT\Retail Stores\powershell_scripts\Assets\matrix.csv
        dest: /root/ansible/ansible_playbooks/phase1/matrix.csv
        flat: yes
      become: True
      become_method: runas

