---
- hosts: all
  gather_facts: false
  tasks:
    - add_host: 
        host: '{{target_machine}}'
      when: target_machine is defined  
#This Play is used to create Virtual Switch
- name: Creating Virtual switch
  hosts: '{{target_machine | default("all")}}'
  vars:
    ansible_connection: winrm
    ansible_winrm_server_cert_validation: ignore
    ansible_ssh_port: 5986
    ansible_winrm_transport: ntlm
  tasks: 
  - name: ping the host
    win_ping: 