---
- hosts: all
  gather_facts: false
  tasks:
    - add_host: 
        host: '{{target_machine}}'
      when: target_machine is defined 
- hosts: '{{target_machine | default("all")}}'
  vars_files:
    - phase1_vault.yml
  gather_facts: false
  vars:
    ansible_winrm_server_cert_validation: ignore
    ansible_ssh_port: 5986
    ansible_winrm_transport: ntlm
    ansible_connection: winrm
  tasks:
   - name: copy image from gold HYPER V to new hyper V
     win_robocopy:
      src: \\10.1.74.5\f$\Export\{{item}}
      dest: F:\Export\{{item}}
      flags: /E /R:10 /W:60 /TBD /MT:4 /TEE /B /COPY:DT /J
      remote_src: True
     become: True
     become_method: runas
     become_flags: logon_type=new_credentials logon_flags=netcredentials_only 
     loop:
     - stp-000stgadc1
     - stp-000stgapp1
     - STP-WHALLEYSQL1